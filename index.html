<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ANAS ALKILIDAR SIGNALS - LIVE GOLD XAU/USD</title>
<script src="https://s3.tradingview.com/tv.js"></script>
<style>
body { background: #0a0a0a; color: #fff; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
h1 { color: gold; font-size: 32px; margin-bottom: 20px; }
#chart { height: 600px; max-width: 1100px; margin: auto; }
#signal { margin-top: 20px; font-size: 28px; color: #00ff00; font-weight: bold; }
#details { margin-top: 12px; font-size: 18px; color: #ccc; }
</style>
</head>
<body>

<h1>ANAS ALKILIDAR SIGNALS - LIVE GOLD XAU/USD</h1>
<div id="chart"></div>
<div id="signal"></div>
<div id="details"></div>

<script>
// ========= TradingView Live Chart =========
new TradingView.widget({
    "container_id": "chart",
    "autosize": true,
    "symbol": "OANDA:XAUUSD",
    "interval": "5",
    "timezone": "Etc/UTC",
    "theme": "dark",
    "style": "1",
    "locale": "ar",
    "toolbar_bg": "#333",
    "studies": [
      "EMAExp@tv-basicstudies",
      "EMAExp@tv-basicstudies",
      "EMAExp@tv-basicstudies",
      "MACD@tv-basicstudies",
      "RSI@tv-basicstudies",
      "BollingerBands@tv-basicstudies"
    ]
});
</script>

<script>
// ===== API DATA & AUTOMATIC ANALYSIS =====
const API_KEY = "b5cfc929a2c852f66794ddccfa4de2d5"; // Ù…ÙØªØ§Ø­Ùƒ Ù…Ù† MetalpriceAPI

async function fetchPrice() {
    const url = `https://api.metalpriceapi.com/v1/latest?api_key=${API_KEY}&base=USD&symbols=XAU`;
    const res = await fetch(url);
    const data = await res.json();
    return parseFloat(data.rates.XAU);
}

// ===== Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª =====
function calculateEMA(values, period) {
    let k = 2 / (period + 1);
    let emaArray = [values[0]];
    for (let i = 1; i < values.length; i++) {
        emaArray.push(values[i] * k + emaArray[i-1] * (1 - k));
    }
    return emaArray;
}

function calculateRSI(values, period = 14) {
    let gains = [], losses = [];
    for (let i = 1; i < values.length; i++) {
        let change = values[i] - values[i-1];
        gains.push(change > 0 ? change : 0);
        losses.push(change < 0 ? Math.abs(change) : 0);
    }
    let avgGain = gains.slice(0, period).reduce((a,b)=>a+b,0)/period;
    let avgLoss = losses.slice(0, period).reduce((a,b)=>a+b,0)/period;
    let rs = avgGain / avgLoss;
    return 100 - (100/(1+rs));
}

function calculateMACD(values) {
    let ema12 = calculateEMA(values, 12);
    let ema26 = calculateEMA(values, 26);
    let macdLine = ema12.map((v,i) => v - ema26[i]);
    let signalLine = calculateEMA(macdLine.slice(), 9);
    return { macdLine, signalLine };
}

// ===== Ø§Ù„ØªÙˆØµÙŠØ© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© =====
async function runAnalysis() {
    const price = await fetchPrice();
    const prices = Array(50).fill(price); // Ø¢Ø®Ø± 50 Ø´Ù…Ø¹Ø© (Ù„Ù„ØªØ¨Ø³ÙŠØ·ØŒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù…ÙƒÙ† Ù†Ø±Ø¨Ø· Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù…ÙˆØ¹ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©)

    const ema20 = calculateEMA(prices, 20).pop();
    const ema50 = calculateEMA(prices, 50).pop();
    const ema200 = calculateEMA(prices, 50).pop(); 
    const rsi = calculateRSI(prices, 14);
    const macdData = calculateMACD(prices);

    let signals = [];
    if (price > ema20) signals.push("Ø´Ø±Ø§Ø¡"); else signals.push("Ø¨ÙŠØ¹");
    if (price > ema50) signals.push("Ø´Ø±Ø§Ø¡"); else signals.push("Ø¨ÙŠØ¹");
    if (price > ema200) signals.push("Ø´Ø±Ø§Ø¡"); else signals.push("Ø¨ÙŠØ¹");
    if (rsi > 50) signals.push("Ø´Ø±Ø§Ø¡"); else signals.push("Ø¨ÙŠØ¹");
    if (macdData.macdLine.pop() > macdData.signalLine.pop()) signals.push("Ø´Ø±Ø§Ø¡"); else signals.push("Ø¨ÙŠØ¹");

    const buyCount = signals.filter(s => s === "Ø´Ø±Ø§Ø¡").length;
    const finalSignal = buyCount >= 3 ? "Ø´Ø±Ø§Ø¡" : "Ø¨ÙŠØ¹";

    const entry = price.toFixed(2);
    const stopLoss = finalSignal === "Ø´Ø±Ø§Ø¡"
        ? (entry - 5).toFixed(2)
        : (parseFloat(entry) + 5).toFixed(2);
    const takeProfit = finalSignal === "Ø´Ø±Ø§Ø¡"
        ? (parseFloat(entry) + 25).toFixed(2)
        : (entry - 25).toFixed(2);

    document.getElementById("signal").innerText = `Ø§Ù„ØªÙˆØµÙŠØ©: ${finalSignal}`;
    document.getElementById("details").innerText =
        `Ø§Ù„Ø¯Ø®ÙˆÙ„: ${entry} | ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø©: ${stopLoss} | Ø¬Ù†ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­: ${takeProfit} ğŸ¯`;
}

// ===== ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚ =====
runAnalysis();
setInterval(runAnalysis, 5*60*1000); // ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
</script>

</body>
</html>
