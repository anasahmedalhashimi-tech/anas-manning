//@version=5
strategy("ANAS ALKILIDAR SIGNALS | XAUUSD 5M", overlay=true, calc_on_every_tick=true, pyramiding=0, initial_capital=10000)

// ===== Inputs =====
riskReward = 5.0
atrLen = 14
atrMult = 1.0

// ===== Indicators =====
ema20 = ta.ema(close, 20)
ema50 = ta.ema(close, 50)
ema200 = ta.ema(close, 200)
rsi = ta.rsi(close, 14)
[macdLine, signalLine, _] = ta.macd(close, 12, 26, 9)
atr = ta.atr(atrLen)

// ===== Conditions =====
buyCond  = close > ema20 and ema20 > ema50 and ema50 > ema200 and rsi > 55 and macdLine > signalLine
sellCond = close < ema20 and ema20 < ema50 and ema50 < ema200 and rsi < 45 and macdLine < signalLine

// ===== Entry (Market) =====
if buyCond and strategy.position_size == 0
    sl = close - atr * atrMult
    tp = close + atr * atrMult * riskReward
    strategy.entry("BUY", strategy.long)
    strategy.exit("BUY TP/SL", "BUY", stop=sl, limit=tp)

if sellCond and strategy.position_size == 0
    sl = close + atr * atrMult
    tp = close - atr * atrMult * riskReward
    strategy.entry("SELL", strategy.short)
    strategy.exit("SELL TP/SL", "SELL", stop=sl, limit=tp)

// ===== Plot Levels =====
var line entryLine = na
var line slLine = na
var line tpLine = na

if strategy.position_size != 0
    line.delete(entryLine)
    line.delete(slLine)
    line.delete(tpLine)
    entryLine := line.new(bar_index, strategy.position_avg_price, bar_index+10, strategy.position_avg_price, color=color.yellow, width=2)
    if strategy.position_size > 0
        slLine := line.new(bar_index, strategy.position_avg_price - atr*atrMult, bar_index+10, strategy.position_avg_price - atr*atrMult, color=color.red, width=2)
        tpLine := line.new(bar_index, strategy.position_avg_price + atr*atrMult*riskReward, bar_index+10, strategy.position_avg_price + atr*atrMult*riskReward, color=color.green, width=2)
    else
        slLine := line.new(bar_index, strategy.position_avg_price + atr*atrMult, bar_index+10, strategy.position_avg_price + atr*atrMult, color=color.red, width=2)
        tpLine := line.new(bar_index, strategy.position_avg_price - atr*atrMult*riskReward, bar_index+10, strategy.position_avg_price - atr*atrMult*riskReward, color=color.green, width=2)

// ===== Visuals =====
plot(ema20, color=color.orange)
plot(ema50, color=color.blue)
plot(ema200, color=color.purple)
