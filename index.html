# gold_elite_telegram_bot.py
import requests, time
import pandas as pd
from datetime import datetime

# ========= CONFIG =========
API_KEY = "b5cfc929a2c852f66794ddccfa4de2d5"
BOT_TOKEN = "PUT_YOUR_BOT_TOKEN"
CHAT_ID = "PUT_YOUR_CHAT_ID"
SYMBOL = "XAU/USD"
# ==========================

def get_data(tf):
    url = f"https://api.twelvedata.com/time_series?symbol={SYMBOL}&interval={tf}&outputsize=200&apikey={API_KEY}"
    data = requests.get(url).json()["values"]
    df = pd.DataFrame(data).astype(float).iloc[::-1]
    return df

def EMA(s, n): return s.ewm(span=n, adjust=False).mean()
def RSI(s, n=14):
    d = s.diff()
    g = d.clip(lower=0).rolling(n).mean()
    l = (-d.clip(upper=0)).rolling(n).mean()
    return 100 - (100 / (1 + (g / (l + 1e-9))))

def in_session():
    h = datetime.utcnow().hour
    return (7 <= h <= 10) or (13 <= h <= 16)  # London & NY

def send(msg):
    url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"
    requests.post(url, json={"chat_id": CHAT_ID, "text": msg})

def check_signal():
    dfs = {tf: get_data(tf) for tf in ["1min","5min","15min"]}
    for df in dfs.values():
        df["ema20"] = EMA(df["close"],20)
        df["ema50"] = EMA(df["close"],50)
        df["ema200"] = EMA(df["close"],200)
        df["rsi"] = RSI(df["close"])

    buy = all(
        df.ema20.iloc[-1] > df.ema50.iloc[-1] > df.ema200.iloc[-1] and
        55 <= df.rsi.iloc[-1] <= 68
        for df in dfs.values()
    )

    sell = all(
        df.ema20.iloc[-1] < df.ema50.iloc[-1] < df.ema200.iloc[-1] and
        32 <= df.rsi.iloc[-1] <= 45
        for df in dfs.values()
    )

    price = dfs["1min"].close.iloc[-1]

    if buy:
        send(f"ðŸŸ¢ GOLD BUY\nPrice: {round(price,2)}\nConfidence: 97â€“98%\nMode: ELITE")
    elif sell:
        send(f"ðŸ”´ GOLD SELL\nPrice: {round(price,2)}\nConfidence: 97â€“98%\nMode: ELITE")

# ===== MAIN LOOP =====
print("ELITE BOT STARTED...")
while True:
    try:
        if in_session():
            check_signal()
        time.sleep(60)
    except:
        time.sleep(60)
